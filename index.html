<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UPN - PrÃ©sence Ã‰tudiante</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: url('UPN.jpg.jpg') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 40, 80, 0.7);
      z-index: 0;
    }

    .logout-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 2;
      background-color: #e60000;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .logout-btn:hover {
      background-color: #990000;
    }

    .container {
      position: relative;
      z-index: 1;
      text-align: center;
      background-color: rgba(255, 255, 255, 0.95);
      padding: 30px 20px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      width: 90%;
      max-width: 500px;
      margin: 20px;
    }

    h1 {
      font-size: 2rem;
      color: #002b50;
      margin-bottom: 10px;
    }

    p {
      font-size: 1rem;
      color: #333;
      margin-bottom: 20px;
    }

    button {
      background-color: #002b50;
      color: white;
      border: none;
      padding: 15px 25px;
      font-size: 1rem;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #0056b3;
    }

    video {
      display: none;
      margin-top: 20px;
      width: 100%;
      max-height: 300px;
      border-radius: 10px;
    }

    @media screen and (max-width: 400px) {
      .container {
        padding: 20px 15px;
      }

      h1 {
        font-size: 1.5rem;
      }

      button {
        font-size: 0.9rem;
        padding: 12px 18px;
      }

      p {
        font-size: 0.9rem;
      }

      .logout-btn {
        font-size: 12px;
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body>
  <div class="overlay"></div>

  <!-- Bouton DÃ©connexion -->
  <button class="logout-btn" onclick="window.location.='admin.html'">ðŸ”’ cÃ©connexion</button>

  <div class="container">
    <h1>Bienvenue Ã  lâ€™UPN</h1>
    <p>Veuillez scanner votre QR code Ã©tudiant pour confirmer votre prÃ©sence.</p>
    <button onclick="startScanner()">ðŸ“· Scanner un QR Code</button>
    <video id="preview"></video>
  </div>

  <script src="https://unpkg.com/html5-qrcode"></script>
  <script>
    function startScanner() {
      const videoElem = document.getElementById("preview");
      videoElem.style.display = "block";

      const qrScanner = new Html5Qrcode("preview");

      qrScanner.start(
        { facingMode: "environment" },
        {
          fps: 10,
          qrbox: { width: 250, height: 250 }
        },
        (decodedText, decodedResult) => {
          try {
            const info = JSON.parse(decodedText);

            fetch("https://script.google.com/macros/s/xxxxxxxxxxxxx/exec", {
              method: "POST",
              body: JSON.stringify({
                nom: info.nom,
                post_nom: info.post_nom,
                prenom: info.prenom,
                matricule: info.matricule
              }),
              headers: {
                "Content-Type": "application/json"
              }
            })
            .then(response => response.text())
            .then(data => {
              alert("PrÃ©sence enregistrÃ©e pour : " + info.nom + " " + info.post_nom);
            })
            .catch(error => {
              alert("Erreur lors de l'enregistrement : " + error);
            });

          } catch (err) {
            alert("QR Code invalide ou mal formatÃ© !");
          }

          qrScanner.stop();
        },
        (error) => {
          console.warn("Erreur de scan : ", error);
        }
      );
    }
  </script>
</body>
</html>
